---
layout: "post"
lang: "ja"
permalink: "/notes/cse-privacy-report/"
title: "CSEのプライバシーに関するレポート"
description: "プライバシーに関する透明性を向上させるため、CSEの外であなたの検索クエリがどのように扱われているのか説明します。"
noindex: true
---

[Customize Search Engine](https://cizzuk.net/projects/cse/)(以下CSE)では、ユーザーのプライバシーを最大限守れるよう努めています。しかし、いつでも完璧なわけではありません。

プライバシーに関する透明性を向上させるため、CSEの外であなたの検索クエリがどのように扱われているのか、私の既知の範囲で説明します。

なお、CSE自体は[プライバシーポリシー](https://i.cizzuk.net/privacy/)に則っています。

## 用語の定義

理解を助けるために、本文におけるいくつかの用語を以下の通りに定義します。

- 検索クエリ
	- あなたがSafariの検索バーから検索した内容のテキストのことです。
- リダイレクト
	- ブラウザが特定のURLにアクセスしたときに、それに基づいた別のURLへ転送されることです。
- リクエスト
	- SafariがWebサイトに検索クエリ等のデータを送信し、結果となるページを要求することです。
- カスタム検索エンジン
	- あなたがCSEで設定した検索エンジンのことです。
- Safariの検索エンジン
	- Safariの設定で選択した検索エンジンのことです。例えばGoogleやDuckDuckGoなどが該当します。

## CSEはリダイレクトをしています

Safariはユーザー保護のために、ユーザーや拡張機能に検索エンジンを自由に変更することを許可していません。あなたがCSEをインストールしていたとしても、SafariはSafariの検索エンジンへアクセスしようとします。

CSEは、SafariがSafariの検索エンジンにアクセスすることを検知して介入を行い、あなたがCSEで設定したカスタム検索エンジンへリダイレクトを実行します。

ここでいくつかのポイントがあります。

1. Safari 18.4以降では、Safariの検索エンジンに検索クエリが送信される前に、CSEが介入して送信を防げる可能性があります。この場合、あなたの検索クエリは漏洩しません。
2. Safari 18.4以降でも、様々な理由でCSEの介入が遅れた場合、Safariの検索エンジンへ検索クエリが送信される可能性があります。
3. Safari 18.4未満の場合、クエリはほぼ確実に漏洩します。これはCSEがURLを検知してリクエストに介入できるタイミングが、最新のSafariよりも遅くなるためです。

CSEはユーザー体験をより良くするために、可能な限り高速にリダイレクトするように改善され続けています。それでも状況によっては検索クエリがSafariの検索エンジンに送信される恐れが常にあります。

## 検索クエリの漏洩を未然に防ぐためのCSE Content Blocker

上記の通り、CSEによるリクエストへの介入が間に合わなければ、Safariの検索エンジンへ検索クエリが漏洩してしまいます。

ほとんどの人にとって、これはSafariの検索エンジンをDuckDuckGoにすれば解決します。DuckDuckGoは[プライバシーを尊重している](https://duckduckgo.com/privacy)検索エンジンだからです。

しかし、DuckDuckGoにさえも検索クエリを知られたくない人々がいるはずです。そういった人々のための追加のオプションとして、CSE Content Blockerという拡張機能を用意しました。

この拡張機能は、Safariのリクエストに合わせてCSEが介入するよりも前に、Safariの起動時からSafariにブロックすべきWebページを宣言しています。CSEの介入に関わらずSafariの検索エンジンへのリクエストはブロックされるため、検索クエリの漏洩を未然に防ぐことができます。

一方でCSE Content Blockerには、未解決の問題があることもわかっています。以下はその一部です。

- 古いバージョンのSafariでは全く検索ができなくなる。
- CSEの設定で「デフォルトの検索エンジン」をオフにすると、検索ができなくなる。
- POSTデータを用いた検索ができなくなる。
- 検索をしたときに、不要なメッセージが一時的に表示される。
- 不要な検索履歴が残ってしまう。
- ブロックされたページに戻ると、意図しない動作をする。

これらの解決が不可能、あるいは解決可能か不明な問題が多く残っているため、CSE Content Blockerはデフォルトで無効で、使用はオプションとなっています。

## プライバシーを守るためにあなたができること

Safariで検索をする上で注意すべきなのは、CSEの設定だけではありません。特にSafariの設定には多くのプライバシーに関わる項目があります。

### CSEの設定

1. カスタム検索エンジンで、POSTデータを用いた検索を使用しない。
2. カスタム検索エンジンのプライバシーポリシーを確認する。

### Safariの設定

1. 「検索エンジン」をDuckDuckGoにする。
2. 「検索エンジンの候補」をオフにする。
3. 「Safariの検索候補」をオフにする。
4. 「クイックWebサイト検索」をオフにする。
5. 「トップヒットを事前に読み込む」をオフにする。

可能であれば以下の設定もおすすめします。

1. CSE Content Blockerをオンにする。
2. 「サイト越えトラッキングを防ぐ」をオンにする。
3. 「IPアドレスを非公開」を選択できる中で最も強力なものにする。
4. 「高度なトラッキングとフィンガープリント保護」を使用する。
5. 「プライバシー保護広告の測定」をオフにする。

もしあなたがiCloud+を購読している場合は、[iCloudプライベートリレー](https://support.apple.com/102602)の使用をおすすめします。

Safariのプライバシーについてより詳しく知りたい場合は[Appleによる説明](https://www.apple.com/legal/privacy/data/ja/safari/)をご覧ください。

### 適切なVPNプロバイダー、コンテンツブロッカー、拡張機能を選択する

VPNプロバイダーはあなたがどのWebサイトにアクセスしたかを知ることができます。プライバシーの保護を理由に使用する場合、信頼できるプロバイダーでなければかえって逆効果です。

また、悪意あるコンテンツブロッカーや拡張機能をインストールすると、あなたのよりプライベートな情報に第三者がアクセスできる可能性があります。

基本的に拡張機能のインストールには消極的であるべきです。例えソースコードが公開されていても、それは安全であることの証明にはなりません。拡張機能の開発元を信頼しすぎないでください。

幸い、Safariは拡張機能のアクセス権について詳細な説明を表示してくれます。あなたが許容できる範囲のみのアクセス権を与えているかどうかを、Safariの設定から確認することをおすすめします。

## さいごに

CSEにはメンテナンス上の多くの課題があります。私のデベロッパーとしての経験不足、技術的負債、古いバージョンをサポートするために必要な工程、不明瞭なSafariの仕様や挙動などです。それでも、Safariが検索エンジンの自由なカスタマイズを認める日まで、改善を続けたいと考えています。

もしあなたがSafariとブラウザ拡張機能に詳しい場合、[GitHubでPull Request](https://github.com/Cizzuk/CSE/pulls)を送ってくださると大変助かります。また、[Issue](https://github.com/Cizzuk/CSE/issues)や[メール](https://cizzuk.net/contact/)や[App Storeのレビュー](https://apps.apple.com/app/cse/id6445840140)で不具合を報告してくだされば、開発の助けになります。
